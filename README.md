### Инструкция по использованию скрипта для конвертации сертификатов из `acme.json` для AdGuard DNS

Этот скрипт предназначен для автоматического извлечения сертификата и закрытого ключа из файла `acme.json`, используемого в системе Let's Encrypt, и конвертации их в формат, который распознает AdGuard DNS. Каждый раз при запуске скрипт будет обновлять файлы сертификатов и ключей в целевой директории.

### Требования

Для работы скрипта вам потребуется:

1. **`jq`** - инструмент для работы с JSON. Установите его на вашем сервере:
   - Для Ubuntu/Debian:
     ```bash
     sudo apt-get install jq
     ```
   - Для CentOS/RHEL:
     ```bash
     sudo yum install jq
     ```

2. **`base64`** - для декодирования сертификатов и ключей из base64. Эта утилита обычно установлена по умолчанию на большинстве Linux-систем.

3. **Файл `acme.json`** с сертификатами, сгенерированными с помощью Let's Encrypt (например, при использовании Traefik).

4. **Доступ к директории конфигурации AdGuard DNS**, где будут сохраняться сертификаты и ключи.

### Описание работы скрипта

1. **Путь к исходному файлу** — скрипт извлекает сертификаты и ключи из файла `acme.json`, расположенного в директории `./letsencrypt/`. Убедитесь, что путь к файлу `acme.json` указан верно.
   
2. **Путь к целевой директории** — результаты работы скрипта сохраняются в директории `./adguard/confdir`, где будет обновляться сертификат и ключ.

3. **Домен** — скрипт извлекает сертификат и ключ для указанного домена (по умолчанию это `kb5snr05.mynotation.ru`). Если вам нужно изменить домен, отредактируйте переменную `DOMAIN`.

### Шаги установки и использования

1. **Скачайте или клонируйте репозиторий на свой сервер**:
   Если вы публикуете скрипт на GitHub, вы можете клонировать репозиторий с помощью команды:
   ```bash
   git clone https://github.com/your-username/your-repo.git
   cd your-repo
   ```

2. **Сделайте скрипт исполнимым**:
   После того как вы скопируете файл на сервер, сделайте его исполнимым:
   ```bash
   chmod +x convert-cert.sh
   ```

3. **Настройте путь к файлам**:
   - Проверьте, что файл `acme.json` существует по указанному пути `./letsencrypt/acme.json`.
   - Убедитесь, что директория `./adguard/confdir` существует. Если нет, скрипт создаст ее автоматически.

4. **Запустите скрипт**:
   Для запуска скрипта выполните следующую команду:
   ```bash
   ./convert-cert.sh
   ```

   Скрипт выполнит следующие действия:
   - Проверит существование файла `acme.json` и директории `./adguard/confdir`.
   - Извлечет сертификат и ключ для указанного домена (`kb5snr05.mynotation.ru` по умолчанию).
   - Декодирует сертификат и ключ из base64 в их исходный формат.
   - Перезапишет файлы `adguard.crt` и `adguard.key` в директории `./adguard/confdir`.
   - Установит права доступа `600` на эти файлы, чтобы они были доступны только владельцу.

5. **Автоматизация**:
   Если скрипт должен запускаться периодически, вы можете настроить его выполнение с помощью `cron` или любого другого планировщика задач. Например, для ежедневного выполнения в полночь добавьте следующее в `crontab`:

   ```bash
   crontab -e
   ```

   И добавьте строку:
   ```bash
   0 0 * * * /path/to/convert-cert.sh
   ```

### Примечания

- Скрипт удаляет старые файлы сертификатов и ключей (`adguard.crt` и `adguard.key`), прежде чем записывать новые. Убедитесь, что у вас есть резервные копии, если это необходимо.
- Если файл `acme.json` не содержит сертификатов для указанного домена, скрипт завершится с ошибкой. Убедитесь, что файл `acme.json` содержит актуальные данные.
- Если сертификаты или ключи не могут быть декодированы, скрипт завершится с ошибкой и выведет сообщение об этом.

### Пример вывода скрипта:

```bash
$ ./convert-cert.sh
Сертификат и ключ для домена kb5snr05.mynotation.ru успешно сконвертированы и сохранены в ./adguard/confdir
```

### Лицензия

Этот скрипт предоставляется под [MIT лицензией](https://opensource.org/licenses/MIT). Вы можете свободно использовать, изменять и распространять его в соответствии с условиями лицензии.

---

Публикуйте этот скрипт на GitHub с описанием, и добавьте файл `README.md` для пользователей, чтобы они могли легко настроить и использовать его.
